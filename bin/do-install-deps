#!/bin/bash

depslist=$(< build-deps )

if which apt-get && ! [ -f /etc/redhat-release ]
then
  echo "I suspect your machine is Debian."
  # Probably Debian, not Fedora/Red Hat.
  # Use alternative package names.
  depslist=$( sed build-deps -e 's,^nodejs-,node-,g' )
else
  echo "I hope your machine is a Fedora/Red Hat family member"
fi

if which pkcon
then
  echo "Oh, good. I see you have PackageKit."
  if pkcheck -a org.freedesktop.packagekit.package-install -p $$$$
  then
    for pkg in $depslist
    do
      pkcon -p -y install $pkg
    done
  else 
    for pkg in $depslist
    do
      sudo pkcon -p -y install $pkg
    done
  fi
  true
  exit
fi

echo "PackageKit not found."

if which dnf
then 
  for pkg in $depslist
  do
    sudo dnf -y install $pkg
  done
elif which yum
then 
  for pkg in $depslist
  do
    sudo yum -y install $pkg
  done
elif which apt-get
then
  for pkg in $depslist
  do
    sudo apt-get -y install $pkg
  done
else
  echo "Unable to find a usable alternative to PackageKit." >&2
  echo "You'll need to install these dependencies yourself:"
  echo "———"
  cat build-deps
  false
  exit 1
fi

true
